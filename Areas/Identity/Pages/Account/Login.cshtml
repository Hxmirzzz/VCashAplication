@page
@model LoginModel

@{
    ViewData["Title"] = "Log in";
}

<h1 class="visually-hidden">@ViewData["Title"]</h1>

<div class="login-page">
    <div class="login-card row g-0">
        <aside class="login-brand col-lg-5 d-none d-lg-flex">
            <div class="login-brand__content">
                <h2 class="login-brand__title">Bienvenido a VCash</h2>
                <p class="login-brand__subtitle">Gestión inteligente de efectivo y servicios</p>
            </div>
            <div class="login-brand__footer">
                <small>© @DateTime.Now.Year Vatco Group</small>
            </div>
        </aside>

        <section class="col-12 col-lg-7 p-4 p-md-5 login-form">
            <header class="login-form__header mb-3 text-center">
                <img src="~/assets/vcash-logo.png" alt="VCash" class="login-form__logo mb-4" />
                <h2 class="login-form__title mb-1">Iniciar sesión</h2>
            </header>

            <form id="account" method="post" class="auth-form">
                <div asp-validation-summary="ModelOnly" class="alert alert-danger" role="alert"></div>
                <div class="form-floating mb-3 has-leading-icon">
                    <input asp-for="Input.UserName" class="form-control" autocomplete="username" aria-required="true" placeholder="tucorreo@empresa.com" />
                    <label asp-for="Input.UserName">Usuario o correo</label>
                    <i class="ri-user-3-line leading-icon" aria-hidden="true"></i>
                    <span asp-validation-for="Input.UserName" class="text-danger small"></span>
                </div>

                <!-- Contraseña -->
                <div class="form-floating mb-2 has-leading-icon has-trailing-btn">
                    <input asp-for="Input.Password" class="form-control" autocomplete="current-password" aria-required="true" placeholder="••••••••" />
                    <label asp-for="Input.Password">Contraseña</label>
                    <i class="ri-lock-2-line leading-icon" aria-hidden="true"></i>
                    <button type="button" class="toggle-password trailing-btn" aria-label="Mostrar u ocultar contraseña">
                        <i class="ri-eye-line"></i>
                    </button>
                    <span asp-validation-for="Input.Password" class="text-danger small"></span>
                </div>

                <div class="d-flex align-items-center justify-content-between mb-3">
                    <div class="form-check m-0">
                        <input class="form-check-input" asp-for="Input.RememberMe" id="rememberMeChk" />
                        <label class="form-check-label" for="rememberMeChk">
                            @Html.DisplayNameFor(m => m.Input.RememberMe)
                        </label>
                    </div>
                    <a id="forgot-password" asp-page="./ForgotPassword" class="link-small">¿Olvidaste tu contraseña?</a>
                </div>

                <button id="login-submit" type="submit" class="btn btn-primary w-100 auth-btn mb-3">
                    Ingresar
                </button>

                <!-- Proveedores externos -->
                @if ((Model.ExternalLogins?.Count ?? 0) > 0)
                {
                    <div class="external-divider"><span>o continúa con</span></div>
                    <div class="d-grid gap-2 mt-3">
                        @foreach (var provider in Model.ExternalLogins!)
                        {
                            <button type="submit"
                                    class="btn btn-outline-primary"
                                    name="provider" value="@provider.Name"
                                    formaction="@Url.Page("./ExternalLogin", new { ReturnUrl = Model.ReturnUrl })"
                                    title="Inicia sesión con @provider.DisplayName">
                                @provider.DisplayName
                            </button>
                        }
                    </div>
                }
                else
                {
                    <div class="external-hint small text-muted">
                        No hay proveedores externos configurados.
                    </div>
                }

                <div class="mt-3 text-center">
                    <a asp-page="./Register" asp-route-returnUrl="@Model.ReturnUrl" class="link-small">
                        ¿No tienes cuenta? Regístrate
                    </a>
                </div>
            </form>
        </section>
    </div>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
}
